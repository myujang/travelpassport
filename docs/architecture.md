# Architecture Overview

This document describes the high-level architecture of the TravelPassport platform.

## System Diagram

```mermaid
<svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="-8 -8 823.447265625 405.5" style="max-width: 823.447265625px;" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid-svg-1752541529085-0sped6195"><style>#mermaid-svg-1752541529085-0sped6195{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#444d56;}#mermaid-svg-1752541529085-0sped6195 .error-icon{fill:#f2dede;}#mermaid-svg-1752541529085-0sped6195 .error-text{fill:#cb2431;stroke:#cb2431;}#mermaid-svg-1752541529085-0sped6195 .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-1752541529085-0sped6195 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-1752541529085-0sped6195 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-1752541529085-0sped6195 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-1752541529085-0sped6195 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-1752541529085-0sped6195 .marker{fill:#444d56;stroke:#444d56;}#mermaid-svg-1752541529085-0sped6195 .marker.cross{stroke:#444d56;}#mermaid-svg-1752541529085-0sped6195 svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-1752541529085-0sped6195 .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#444d56;}#mermaid-svg-1752541529085-0sped6195 .cluster-label text{fill:#2f363d;}#mermaid-svg-1752541529085-0sped6195 .cluster-label span,#mermaid-svg-1752541529085-0sped6195 p{color:#2f363d;}#mermaid-svg-1752541529085-0sped6195 .label text,#mermaid-svg-1752541529085-0sped6195 span,#mermaid-svg-1752541529085-0sped6195 p{fill:#444d56;color:#444d56;}#mermaid-svg-1752541529085-0sped6195 .node rect,#mermaid-svg-1752541529085-0sped6195 .node circle,#mermaid-svg-1752541529085-0sped6195 .node ellipse,#mermaid-svg-1752541529085-0sped6195 .node polygon,#mermaid-svg-1752541529085-0sped6195 .node path{fill:#ffffff;stroke:#d1d5da;stroke-width:1px;}#mermaid-svg-1752541529085-0sped6195 .flowchart-label text{text-anchor:middle;}#mermaid-svg-1752541529085-0sped6195 .node .label{text-align:center;}#mermaid-svg-1752541529085-0sped6195 .node.clickable{cursor:pointer;}#mermaid-svg-1752541529085-0sped6195 .arrowheadPath{fill:#000000;}#mermaid-svg-1752541529085-0sped6195 .edgePath .path{stroke:#444d56;stroke-width:2.0px;}#mermaid-svg-1752541529085-0sped6195 .flowchart-link{stroke:#444d56;fill:none;}#mermaid-svg-1752541529085-0sped6195 .edgeLabel{background-color:#ffffff99;text-align:center;}#mermaid-svg-1752541529085-0sped6195 .edgeLabel rect{opacity:0.5;background-color:#ffffff99;fill:#ffffff99;}#mermaid-svg-1752541529085-0sped6195 .labelBkg{background-color:rgba(255, 255, 255, 0.5);}#mermaid-svg-1752541529085-0sped6195 .cluster rect{fill:rgba(3, 102, 214, 0.07);stroke:#2188ff;stroke-width:1px;}#mermaid-svg-1752541529085-0sped6195 .cluster text{fill:#2f363d;}#mermaid-svg-1752541529085-0sped6195 .cluster span,#mermaid-svg-1752541529085-0sped6195 p{color:#2f363d;}#mermaid-svg-1752541529085-0sped6195 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:#dbedff;border:1px solid #2188ff;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-1752541529085-0sped6195 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#444d56;}#mermaid-svg-1752541529085-0sped6195 :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style><g><marker orient="auto" markerHeight="12" markerWidth="12" markerUnits="userSpaceOnUse" refY="5" refX="6" viewBox="0 0 10 10" class="marker flowchart" id="mermaid-svg-1752541529085-0sped6195_flowchart-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"/></marker><marker orient="auto" markerHeight="12" markerWidth="12" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart" id="mermaid-svg-1752541529085-0sped6195_flowchart-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"/></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart" id="mermaid-svg-1752541529085-0sped6195_flowchart-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"/></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart" id="mermaid-svg-1752541529085-0sped6195_flowchart-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"/></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart" id="mermaid-svg-1752541529085-0sped6195_flowchart-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"/></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart" id="mermaid-svg-1752541529085-0sped6195_flowchart-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"/></marker><g class="root"><g class="clusters"><g id="Cloudflare" class="cluster default flowchart-label"><rect height="287.5" width="394.509765625" y="102" x="212.8828125" ry="0" rx="0" style=""/><g transform="translate(372.8798828125, 102)" class="cluster-label"><foreignObject height="18.5" width="74.515625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Cloudflare</span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid-svg-1752541529085-0sped6195_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-A LE-B" id="L-A-B-0" d="M426.899,160.5L424.07,166.208C421.242,171.917,415.586,183.333,410.282,193.961C404.978,204.589,400.026,214.427,397.55,219.346L395.075,224.266"/><path marker-end="url(#mermaid-svg-1752541529085-0sped6195_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-B LE-C" id="L-B-C-0" d="M384.262,262.5L384.262,268.208C384.262,273.917,384.262,285.333,384.262,295.867C384.262,306.4,384.262,316.05,384.262,320.875L384.262,325.7"/><path marker-end="url(#mermaid-svg-1752541529085-0sped6195_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-D LE-E" id="L-D-E-0" d="M590.5,25.249L506.907,32.333C423.314,39.416,256.128,53.583,172.535,66.375C88.941,79.167,88.941,90.583,88.941,99.575C88.941,108.567,88.941,115.133,88.941,118.417L88.941,121.7"/><path marker-end="url(#mermaid-svg-1752541529085-0sped6195_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-E LE-B" id="L-E-B-0" d="M163.938,160.5L189.496,166.208C215.055,171.917,266.172,183.333,298.524,194.215C330.876,205.096,344.462,215.443,351.256,220.616L358.049,225.789"/><path marker-end="url(#mermaid-svg-1752541529085-0sped6195_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-A LE-F" id="L-A-F-0" d="M443.496,160.5L446.324,166.208C449.152,171.917,454.809,183.333,487.1,196.263C519.392,209.193,578.318,223.636,607.782,230.857L637.245,238.078"/><path marker-end="url(#mermaid-svg-1752541529085-0sped6195_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-D LE-F" id="L-D-F-0" d="M683.491,33.5L681,39.208C678.509,44.917,673.527,56.333,671.036,67.75C668.545,79.167,668.545,90.583,668.545,103.25C668.545,115.917,668.545,129.833,668.545,145.292C668.545,160.75,668.545,177.75,668.545,191.075C668.545,204.4,668.545,214.05,668.545,218.875L668.545,223.7"/><path marker-end="url(#mermaid-svg-1752541529085-0sped6195_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-A LE-G" id="L-A-G-0" d="M466.7,160.5L477.437,166.208C488.173,171.917,509.645,183.333,555.113,196.352C600.582,209.37,670.046,223.991,704.779,231.301L739.511,238.611"/><path marker-end="url(#mermaid-svg-1752541529085-0sped6195_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-D LE-G" id="L-D-G-0" d="M717.938,33.5L727.186,39.208C736.435,44.917,754.931,56.333,764.179,67.75C773.428,79.167,773.428,90.583,773.428,103.25C773.428,115.917,773.428,129.833,773.428,145.292C773.428,160.75,773.428,177.75,773.428,191.075C773.428,204.4,773.428,214.05,773.428,218.875L773.428,223.7"/></g><g class="edgeLabels"><g transform="translate(409.9296875, 194.75)" class="edgeLabel"><g transform="translate(-13.90234375, -9.25)" class="label"><foreignObject height="18.5" width="27.8046875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel">RPC</span></div></foreignObject></g></g><g transform="translate(384.26171875, 296.75)" class="edgeLabel"><g transform="translate(-13.3046875, -9.25)" class="label"><foreignObject height="18.5" width="26.609375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel">SQL</span></div></foreignObject></g></g><g transform="translate(88.94140625, 67.75)" class="edgeLabel"><g transform="translate(-22.83203125, -9.25)" class="label"><foreignObject height="18.5" width="45.6640625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel">HTTPS</span></div></foreignObject></g></g><g transform="translate(317.2890625, 194.75)" class="edgeLabel"><g transform="translate(-17.43359375, -9.25)" class="label"><foreignObject height="18.5" width="34.8671875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel">REST</span></div></foreignObject></g></g><g transform="translate(460.46484375, 194.75)" class="edgeLabel"><g transform="translate(-16.6328125, -9.25)" class="label"><foreignObject height="18.5" width="33.265625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel">Auth</span></div></foreignObject></g></g><g transform="translate(668.544921875, 143.75)" class="edgeLabel"><g transform="translate(-16.6328125, -9.25)" class="label"><foreignObject height="18.5" width="33.265625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel">Auth</span></div></foreignObject></g></g><g transform="translate(531.1171875, 194.75)" class="edgeLabel"><g transform="translate(-34.01953125, -9.25)" class="label"><foreignObject height="18.5" width="68.0390625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel">Payments</span></div></foreignObject></g></g><g transform="translate(773.427734375, 143.75)" class="edgeLabel"><g transform="translate(-34.01953125, -9.25)" class="label"><foreignObject height="18.5" width="68.0390625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel">Payments</span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(435.197265625, 143.75)" id="flowchart-A-82" class="node default default flowchart-label"><rect height="33.5" width="268.3671875" y="-16.75" x="-134.18359375" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-126.68359375, -9.25)" style="" class="label"><rect/><foreignObject height="18.5" width="253.3671875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">travelpassport-web (Remix Worker)</span></div></foreignObject></g></g><g transform="translate(384.26171875, 245.75)" id="flowchart-B-83" class="node default default flowchart-label"><rect height="33.5" width="272.7578125" y="-16.75" x="-136.37890625" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-128.87890625, -9.25)" style="" class="label"><rect/><foreignObject height="18.5" width="257.7578125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">api-worker (Hono, Drizzle, D1, RPC)</span></div></foreignObject></g></g><g transform="translate(384.26171875, 347.75)" id="flowchart-C-84" class="node default default flowchart-label"><rect height="33.5" width="103.515625" y="-16.75" x="-51.7578125" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-44.2578125, -9.25)" style="" class="label"><rect/><foreignObject height="18.5" width="88.515625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">D1 Database</span></div></foreignObject></g></g><g transform="translate(690.80078125, 16.75)" id="flowchart-D-85" class="node default default flowchart-label"><rect height="33.5" width="200.6015625" y="-16.75" x="-100.30078125" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-92.80078125, -9.25)" style="" class="label"><rect/><foreignObject height="18.5" width="185.6015625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Mobile App (React Native)</span></div></foreignObject></g></g><g transform="translate(88.94140625, 143.75)" id="flowchart-E-86" class="node default default flowchart-label"><rect height="33.5" width="177.8828125" y="-16.75" x="-88.94140625" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-81.44140625, -9.25)" style="" class="label"><rect/><foreignObject height="18.5" width="162.8828125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Public REST API (Hono)</span></div></foreignObject></g></g><g transform="translate(668.544921875, 245.75)" id="flowchart-F-87" class="node default default flowchart-label"><rect height="33.5" width="52.3046875" y="-16.75" x="-26.15234375" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-18.65234375, -9.25)" style="" class="label"><rect/><foreignObject height="18.5" width="37.3046875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Clerk</span></div></foreignObject></g></g><g transform="translate(773.427734375, 245.75)" id="flowchart-G-88" class="node default default flowchart-label"><rect height="33.5" width="57.4609375" y="-16.75" x="-28.73046875" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-21.23046875, -9.25)" style="" class="label"><rect/><foreignObject height="18.5" width="42.4609375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Stripe</span></div></foreignObject></g></g></g></g></g></svg>
```

## Components

- **travelpassport-web (Remix Worker):** The web frontend, deployed on Cloudflare Workers, communicates with the API worker via RPC for all business logic and data needs.
- **api-worker (Hono, Drizzle, D1, RPC):** The backend API, responsible for all database operations, business logic, and exposing both REST (for mobile) and RPC (for web) interfaces.
- **D1 Database:** Cloudflare's serverless SQL database, managed via Drizzle ORM.
- **Mobile App (React Native):** The mobile client, communicates with the API worker via public REST endpoints.
- **Clerk:** Authentication provider for both web and mobile clients.
- **Stripe:** Payment provider for order and fulfillment workflows.

## Data Flow
- The web app uses RPC to call business logic in the API worker.
- The mobile app uses REST endpoints exposed by the API worker.
- All database operations are handled by the API worker using Drizzle ORM and D1.
- Authentication is managed by Clerk for both web and mobile.
- Payments are processed via Stripe, with order status tracked in D1. 